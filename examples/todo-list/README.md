# Todo App Demo

A Todo list app demonstrating `tauri-plugin-libsql` with Drizzle ORM, automatic migrations, and optional AES-256 encryption.

## What it shows

- Drizzle ORM via `createDrizzleProxy` (sqlite-proxy pattern)
- Browser-safe migrations with `migrate()` from the plugin
- Optional encryption via environment variable
- Tailwind CSS styling

## Running

### Prerequisites

- [Rust](https://rustup.rs/)
- [Bun](https://bun.sh/) (or Node.js v18+)

### Install dependencies

```bash
bun install
```

### Start dev server

```bash
bun run tauri dev
```

### With encryption enabled

```bash
LIBSQL_ENCRYPTION_KEY=my-secret-key bun run tauri dev
```

The key is padded/truncated to 32 bytes automatically. The app shows a lock badge when encryption is active.

## Database location

The database file (`todos.db` or `todos.enc.db`) is created in the **current working directory** when you run the command. Running from `examples/tauri-app/` puts it there.

## Architecture

```
src/App.svelte
  │
  ├── Database.load('sqlite:todos.db')   ← opens/creates the DB file
  ├── migrate('sqlite:todos.db', migrations)  ← runs pending SQL migrations
  └── drizzle(createDrizzleProxy(...))   ← Drizzle ORM instance for queries

drizzle/*.sql     ← migration files (generated by drizzle-kit, bundled by Vite)
src/lib/schema.ts ← Drizzle table definitions
src/lib/db.ts     ← singleton Drizzle instance
```

### Startup sequence

```typescript
// 1. Open/create database file
await Database.load(dbFullPath);

// 2. Run pending migrations (idempotent)
await migrate(dbFullPath, migrations);

// 3. Now safe to query
await loadTodos();
```

This order matters. Querying before migrations run causes "no such table" errors.

## Schema changes

```bash
# 1. Edit src/lib/schema.ts
# 2. Generate a new migration
bun run db:generate
# 3. Restart the app — migration runs automatically on next launch
```

## Project structure

```
examples/tauri-app/
├── drizzle/              # Generated SQL migration files
├── src/
│   ├── App.svelte        # Main component (startup sequence, CRUD)
│   └── lib/
│       ├── schema.ts     # Drizzle table definitions
│       └── db.ts         # Singleton Drizzle instance
├── src-tauri/
│   └── src/lib.rs        # Plugin registration, encryption from env
├── drizzle.config.ts     # drizzle-kit config
└── package.json          # Scripts: db:generate, tauri
```
